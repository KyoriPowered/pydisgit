name: "build"

on:
  push:
    branches: "**"
    tags-ignore: ["**"]
  pull_request:

permissions:
  contents: "read"
  checks: write
  issues: write
  pull-requests: write

jobs:
  build:
    # Only run on PRs if the source branch is on someone else's repo
    runs-on: ubuntu-latest
    steps:
      - name: "setup"
        uses: "KyoriPowered/.github/.github/actions/setup-python-env@trunk"
      - name: "setup / install reviewdog"
        uses: "reviewdog/action-setup@v1.3.0"
        with:
          reviewdog_version: "latest"
      - name: "setup / install deps"
        id: "install"
        run: "poetry install"
      - name: "run ruff / apply format"
        env:
          REVIEWDOG_GITHUB_API_TOKEN: "${{ secrets.GITHUB_TOKEN }}"
        run: |
          poetry run ruff format --diff | reviewdog -reporter=github-check -f=diff -f.diff.strip=0
      - name: "run ruff / check"
        run: "poetry run ruff check --output-format=github"
